name: Go
on: [push, pull_request]
jobs:

  build:
    name: Test and Lint
    runs-on: ubuntu-latest
    steps:

    - name: Set up Go 1.13
      uses: actions/setup-go@v1
      with:
        go-version: 1.13
      id: go

    - name: Check out code into the Go module directory
      uses: actions/checkout@v1

    - name: Get dependencies
      run: |
        go mod download

    - name: Test
      run: |
        go test -race -coverprofile=coverage.txt -covermode=atomic -coverpkg=./... ./...
        CODECOV_TOKEN="01bc2a19-099e-48ef-bde0-968b0848d694" bash <(curl -s https://codecov.io/bash)

    - name: Lint
      run: |
        GO111MODULE=on go mod tidy && git --no-pager diff --stat go.*

        curl -sLO https://github.com/golangci/golangci-lint/releases/download/v1.19.1/golangci-lint-1.19.1-linux-amd64.tar.gz
        tar -zxvf golangci-lint-1.19.1-linux-amd64.tar.gz
        chmod +x golangci-lint-1.19.1-linux-amd64/golangci-lint
        GO111MODULE=on golangci-lint-1.19.1-linux-amd64/golangci-lint run
